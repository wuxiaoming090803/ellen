<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>咨询</title>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/flyQuestion.css" rel="stylesheet"/>
    <script>
        document.documentElement.style.fontSize = document.documentElement.clientWidth / 750 * 100 + 'px';
    </script>
    <style>
        .mui-toast-container {
            bottom: 50% !important;
        }
    </style>
</head>
<body>
<div class="loading_box">
    <div id="ajaxbar1">
        <div id="block1" class="barlittle"></div>
        <div id="block2" class="barlittle"></div>
        <div id="block3" class="barlittle"></div>
        <div id="block4" class="barlittle"></div>
        <div id="block5" class="barlittle"></div>
    </div>
</div>
<div class="wrap"></div>
<div class="mainContent1" id="mainContent">
    <div class="back-latern" id="back-latern">
        <img src="img/lanternLf.png" class="back-laternf" id="back-laternf"/>
        <img src="img/lanternLf.png" class="back-laternf animateCls"/>
        <span class="arrow" id="backArrow"></span>
    </div>

    <div class="productHeader">
        <img src="img/items-title.png" alt="">
    </div>
    <div class="score-content" id="score-content">
        <img src="img/lantern.png" class="score-lantern"/>
        <img src="img/lantern.png" class="score-lantern animateCls"/>
        <img src="img/score.png" class="score-icon"/>
    </div>
    <div class="top-text-content" id="top-content">
        <img src="img/items-content.png" class="img-text">
    </div>
    <div class="optionBox" id="optionBox">
        <!--  <img src="${ctx}/static/img/new_line.png" class="line-cls"> -->
        <span>
	      		<input type="checkbox" name="option" id="option1" value="1"/>
	      		<label class="checkLabel1" for="option1"></label>
	      	</span>

        <span>
		      	<input type="checkbox" name="option" id="option2" value="2"/>
		      	<label class="checkLabel2" for="option2"></label>
	      	</span>

        <span>
		      	<input type="checkbox" name="option" id="option3" value="3"/>
		      	<label class="checkLabel3" for="option3"></label>
      	    </span>
        <span>
		      	<input type="checkbox" name="option" id="option4" value="4"/>
		      	<label class="checkLabel4" for="option4"></label>
	      	</span>
        <span>
		      	<input type="checkbox" name="option" id="option5" value="5"/>
		      	<label class="checkLabel5" for="option5"></label>
	      	</span>
        <span>
		      	<input type="checkbox" name="option" id="option6" value="6"/>
		      	<label class="checkLabel6" for="option6"></label>
	      	</span>
    </div>
    <div class="commitBtn start" id="start">
        <button class="startBtn" id="clickBtn"></button>
    </div>
    <div class="commitBtn mui-commit">
        <button class="commitCls" id="commit-btn"></button>
    </div>
</div>
<div class="warp_dialog warp_dialogQ">
    <!--弹出窗口主体-->
    <div class="dialogMain">
        <div class="dialogContent">
            <!--弹出窗口主要内容-->
            <div class="dialogCenter" id="dialogCenter">
                <h4>是否提交</h4>
                <h6></h6>
            </div>
            <!--弹出窗口四个角-->
            <div class="corner cornerTL"></div>
            <div class="corner cornerTR"></div>
            <div class="corner cornerBL"></div>
            <div class="corner cornerBR"></div>
        </div>
        <!--弹出窗口底部-->
        <div class="dialogFooter" id="dialogFooter">
            <button id="cancel"><img src="img/pop_qx.png" alt="取消"></button>
            <button id="ok"><img src="img/pop_qr.png" alt="确认"></button>
        </div>
    </div>
</div>
<div class="warp_dialog warp_dialogL">
    <!--弹出窗口主体-->
    <div id="hide_window" class="hide_window">
        <img class="congratulation animated" src="img/congratulation.png">
        <div class="score-text animated">
            <span class="coin-text-m">+</span>
            <span id="coin-text">1.00</span>
            <span class="coin-text-s">stc</span>
        </div>
        <audio style="display:none" id="musicBox" preload="metadata" autoplay="false"></audio>
        <img class="coin animated" src="img/coin.png">
        <img class="closebtn animated" src="img/closebtn.png"/>
    </div>
</div>
<script src="js/jquery.js"></script>
<script src="js/mui.min.js"></script>
<script type="text/javascript">
    var t_img; // 定时器
    var isLoad = true; // 控制变量
    // 判断图片加载状况，加载完成后回调
    isImgLoad(function () {
        // 加载完成
    });

    // 判断图片加载的函数
    function isImgLoad(callback) {
        // 查找所有图，迭代处理
        $('img').each(function () {
            // 找到为0就将isLoad设为false，并退出each
            if (this.height === 0) {
                isLoad = false;
                return false;
            }
        });
        // 为true，没有发现为0的。加载完毕
        if (isLoad) {
            clearTimeout(t_img); // 清除定时器
//			        console.log("加载完成");
//			        alert("加载完成");
            $(document).ready(function () {

                $('.loading_box').hide();
                var arry = [];
                document.getElementById("clickBtn").addEventListener("tap", function () {
                    document.getElementById("start").classList.add("focusCls");
                    document.getElementById("top-content").classList.add('mui-animation-top');
                    document.getElementById("optionBox").classList.add('mui-animation-optionBox');
                    document.getElementById("commit-btn").classList.add('mui-animation-commitBtn');
                    document.getElementById("optionBox").classList.remove('mui-animation-optionBoxOut');
                    document.getElementById("score-content").classList.add('mui-animation-scoreLatern');
                    document.getElementById("back-latern").classList.add("clickFocus")

                })
                document.getElementById("back-latern").addEventListener("tap", function () {
                    document.getElementById("start").classList.remove("focusCls");
                    document.getElementById("top-content").classList.remove('mui-animation-top');
                    document.getElementById("optionBox").classList.remove('mui-animation-optionBox');
                    document.getElementById("optionBox").classList.add('mui-animation-optionBoxOut');

                    document.getElementById("commit-btn").classList.remove('mui-animation-commitBtn');
                    document.getElementById("score-content").classList.remove('mui-animation-scoreLatern');
                    document.getElementById("back-latern").classList.remove("clickFocus")
                })
                document.getElementById("commit-btn").addEventListener("tap", function () {
                    document.getElementById("commit-btn").classList.add("commitCls");
                    if (arry.length == 0) {
                        mui.alert("请选择答案");
                        return;
                    }
                    openDailog();
                    $(".confirm").attr("id", "scoreConfirm");
                    $("#dialogCenter").html('' +
                        ' <h4>是否提交</h4>' +
                        '<h6></h6>');

                    $("#scoreConfirm").click(function () {

                        dialogFooter();

                        $(".productPage").addClass("completePage");
                    })
                });
                document.getElementById("score-content").addEventListener("tap", function () {
                    window.location.href = "myAnswers.html";
                });
                $('.optionBox').on("change", "input", function () {
                    var num = this.value;
                    if (this.checked) {
                        arry.push(this.value);
                        this.nextElementSibling.classList.add("checkLabelCli" + num);
                    } else {
                        arry.splice(arrySplice(this.value, arry), 1);
                        this.nextElementSibling.classList.remove("checkLabelCli" + num);
                    }
                });

                function select(result) {
                    for (var k = 0; k < result.length; k++) {
                        document.getElementById("option" + result[k]).checked = false;
                        document.getElementById("option" + result[k]).nextElementSibling.classList.remove("checkLabelCli" + result[k]);
                    }
                    arry = [];
                }

                function arrySplice(val, arry) {
                    for (var i = 0; i < arry.length; i++) {
                        if (arry[i] == val) return i;
                    }
                    return -1;
                }

                function sortNumber(a, b) {
                    return a - b
                }
                lingguangalert();
                //弹出窗口js
                function openDailog() {
                    $(".warp_dialogQ").removeClass("warp_dialog3");
                    $(".warp_dialogQ").removeClass("warp_dialog4");
                    $(".warp_dialogQ").addClass("warp_dialog1");
                    $(".dialogMain").removeClass("dialogMax");
                    setTimeout(function () {
                        $(".warp_dialogQ").addClass("warp_dialog2");
                    }, 300);
                };

                //关闭弹窗
                function dialogFooter() {
                    $(".warp_dialogQ").addClass("warp_dialog3");
                    setTimeout(function () {
                        $(".warp_dialogQ").addClass("warp_dialog4");
                        $(".warp_dialogQ").removeClass("warp_dialog2");
                        $(".warp_dialogQ").removeClass("warp_dialog1");
                    }, 300);
                };
                    function openDailogL() {
                        $(".warp_dialogL").removeClass("warp_dialog3");
                        $(".warp_dialogL").removeClass("warp_dialog4");
                        $(".warp_dialogL").addClass("warp_dialog1");
                        $(".dialogMain").removeClass("dialogMax");
                        setTimeout(function () {
                            $(".warp_dialogL").addClass("warp_dialog2");
                        }, 300);
                        show_window();
                    };
             function lingguangalert(){
               //弹出层尺寸
                   var alertHeight = ($(document.body).outerWidth(true))*656*0.87/666 +'px';
                   $('#hide_window').height(alertHeight);

                   //文字行高
                   var boxH = $('.score-text').outerHeight();
                   var lineH = boxH +'px';
                   $('.score-text span').css('line-height',lineH);
                   //关闭弹出层
                   $('.closebtn').click(function(){
                       dialogFooterL();
                   });
               }
                 function dialogFooterL() {
                    $(".warp_dialogL").addClass("warp_dialog3");
                    setTimeout(function () {
                        $(".warp_dialogL").addClass("warp_dialog4");
                        $(".warp_dialogL").removeClass("warp_dialog2");
                        $(".warp_dialogL").removeClass("warp_dialog1");
                    }, 300);
                };
                function show_window(){
                        //文字行高
                   var boxH = $('.score-text').outerHeight();
                   var lineH = boxH +'px';
                   $('.score-text span').css('line-height',lineH);
                   //弹出层动画
                  $('.coin').addClass('flipInY');
                  $('.congratulation').addClass('slideInUp');
                  $('.score-text').addClass('fadeInUp');
                  document.getElementById('musicBox').src = ""; 
                  document.getElementById('musicBox').src = "img/5.mp3";  
                  document.getElementById('musicBox').play();
                  setTimeout(function(){
                       $('.coin').removeClass('flipInY');
                       $('.congratulation').removeClass('slideInUp');
                       $('.score-text').removeClass('fadeInUp');
                  },1000);
                  setInterval(function(){
                       $('.coin').addClass('flipInY');
                       setTimeout(function(){
                        $('.coin').removeClass('flipInY');
                       },2900);
                  },3000)
                }
                $(".closebtn").click(function(){
                    dialogFooterL();
                })
                $("#cancel").click(function () {
                    dialogFooter();
                });
                $('#ok').click(function () {

                    arry.sort(sortNumber);
                    var result = arry.join(",");
                    dialogFooter();
                    mui.toast("提交成功");
                    select(arry);
                    openDailogL();
                    // $.post("${ctx}/consult/wx/doAnswer", {
                    //         answer: result
                    //     }, function (result) {
                    //         var code = result['code'];
                    //         var msg = result['msg'];
                    //         var coin = result['result'];
                    //         if (coin && (coin + 0) >= 0) {
                    //             $("#coin-text").html(coin);
                    //             
                    //             // msg += "<br/>获取灵光币：$" + coin;
                    //         }
                          
                    //     }, 'json'
                    // );
                });

            })
            // 回调函数
            callback();
            
            // 为false，因为找到了没有加载完成的图，将调用定时器递归
        } else {
            isLoad = true;
            t_img = setTimeout(function () {
                isImgLoad(callback); // 递归扫描
            }, 500); // 我这里设置的是500毫秒就扫描一次，可以自己调整
        }
    }
</script>
</body>

</html>